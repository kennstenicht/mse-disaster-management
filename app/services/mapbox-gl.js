import Ember from 'ember';

const {
  Service,
  run: {
    bind
  }
} = Ember;

export default Service.extend({
  markers: {},
  maps: {},

  setupMap: function(elementId, settings) {
    var maps = this.get('maps'),
        interactive = settings.baseMap === true ? false : true;

    maps[elementId] = new mapboxgl.Map({
      container: elementId,
      style: 'https://www.mapbox.com/mapbox-gl-styles/styles/light-v7.json',
      center: settings.geoPoint,
      zoom: settings.zoom,
      interactive: interactive
    });
    this.set('maps', maps);
  },

  setMarker: function(shape) {
    // A Polygon neads to be inside of an extra array
    if(shape.sourceType === 'Polygon') {
      shape.geoPoints = [shape.geoPoints];
    }

    // Add source to all maps
    for(var map in this.get('maps')) {
      map = this.get('maps.'+map);
      map.addSource(shape.layerId, {
        "type": "geojson",
        "data": {
          "type": "Feature",
          "properties": {},
          "geometry": {
            "type": shape.sourceType,
            "coordinates": shape.geoPoints
          }
        }
      });

      // Add layer to map and link source to this layer + styling of the layer
      map.addLayer({
        "id": shape.layerId,
        "type": shape.layerType,
        "source": shape.layerId,
        "interactive": true,
        "layout": {
          "line-join": "round",
          "line-cap": "round"
        },
        "paint": {
          "fill-color": "#cc0e0e",
          "fill-opacity": "0.2",
          "fill-outline-color": "#cc0e0e",
          "outline-size": 8,
          "line-color": "#cc0e0e",
          "line-width": 8
        }
      });
    }
  },

  addLayers: function() {

    // Add source to all maps
    for(var map in this.get('maps')) {

      map = this.get('maps.'+map);
      console.log(map);
      map.addSource("route", {
        "type": "geojson",
        "data": {
          "type": "FeatureCollection",
          "crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:OGC:1.3:CRS84" } },
          "features": [{
             "type": "Feature",
             "properties": {
                "id": 1,
                "level": 5
             },
             "geometry": {
               "type": "Polygon",
                "coordinates": [ [ [ 6.766272510491854, 51.282233161097096 ], [ 6.766907734293587, 51.282183753063336 ], [ 6.766565437529958, 51.280306208397988 ], [ 6.766009205289063, 51.280339148439481 ], [ 6.766012496604098, 51.280386499707745 ], [ 6.765920339783121, 51.280390617207026 ], [ 6.766272510491854, 51.282233161097096 ] ] ] } },
{ "type": "Feature", "properties": { "id": 2, "level": 5 }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.764890158177202, 51.279540345774315 ], [ 6.764455704592598, 51.278974175679828 ], [ 6.7643393089199, 51.279011022696587 ], [ 6.764271790978459, 51.279032396644666 ], [ 6.762290019299644, 51.279659755303179 ], [ 6.762744220774458, 51.280213564404654 ], [ 6.764641272435807, 51.279618426147856 ], [ 6.764697916676743, 51.279600655632748 ], [ 6.764890158177202, 51.279540345774315 ] ] ] } },
            { "type": "Feature",
               "properties": {
                  "id": 3,
                  "level": 5
                },
                 "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.768237425567681, 51.279830633916625 ], [ 6.768096721849941, 51.27963504990889 ], [ 6.767585745190774, 51.279779164521877 ], [ 6.766740700055569, 51.279502258179754 ], [ 6.76671354670653, 51.279522331377599 ], [ 6.766490560112916, 51.279426597615483 ], [ 6.766442836044909, 51.279462626474562 ], [ 6.766375364086696, 51.279428141710028 ], [ 6.766421442497184, 51.279392112823906 ], [ 6.766338336792552, 51.279347848725138 ], [ 6.766260990889233, 51.279297922888126 ], [ 6.766184467814672, 51.279244394095393 ], [ 6.766102184938799, 51.279184688829901 ], [ 6.765999331343959, 51.279106454226635 ], [ 6.765940087673331, 51.279132704009633 ], [ 6.765889895119051, 51.27908689555499 ], [ 6.765956544248507, 51.279057042829585 ], [ 6.76581419487325, 51.278912925951339 ], [ 6.765745900086272, 51.278936087622952 ], [ 6.765705581477096, 51.278888734859599 ], [ 6.765775521921587, 51.278865058459601 ], [ 6.765672668326746, 51.278708073324879 ], [ 6.765578043019495, 51.278731235099769 ], [ 6.765569814731908, 51.278715793917797 ], [ 6.765592031108393, 51.27871733803623 ], [ 6.765605196368533, 51.278712190974588 ], [ 6.765612601827361, 51.27870395567475 ], [ 6.765606019197291, 51.27869160272224 ], [ 6.765591208279634, 51.278684911538221 ], [ 6.765569814731908, 51.278685940951235 ], [ 6.765553358156733, 51.278694176254298 ], [ 6.765544307040387, 51.278677190940115 ], [ 6.765638109518881, 51.278657117378913 ], [ 6.765620007286191, 51.278616970230161 ], [ 6.765580511505771, 51.278517116913186 ], [ 6.765546775526663, 51.278402851510968 ], [ 6.76552949612273, 51.278274173915896 ], [ 6.765447213246858, 51.278277262182513 ], [ 6.765445567589342, 51.278218585083437 ], [ 6.76552373632142, 51.278216526236477 ], [ 6.765531964609006, 51.278048729900632 ], [ 6.765453795876927, 51.278046671046035 ], [ 6.765459555678238, 51.277989537795371 ], [ 6.76553690158156, 51.277993655509512 ], [ 6.765614247484879, 51.277756886347198 ], [ 6.765575574533219, 51.27775070974397 ], [ 6.765647160635227, 51.277609162360243 ], [ 6.765611778998601, 51.277602985737239 ], [ 6.765640578005157, 51.277547396092494 ], [ 6.765670199840471, 51.277552028565459 ], [ 6.76597958345375, 51.277201503458386 ], [ 6.765950784447194, 51.277189150101769 ], [ 6.766003445487753, 51.277147972222828 ], [ 6.766032244494308, 51.277160840313996 ], [ 6.766209975506193, 51.27703473286499 ], [ 6.766117818685215, 51.276977083630157 ], [ 6.766168011239497, 51.276941567547709 ], [ 6.76547724129013, 51.27651104103181 ], [ 6.765456216824226, 51.276518438228671 ], [ 6.765423351212856, 51.276498901027409 ], [ 6.765123876314535, 51.276632763261674 ], [ 6.765141029792338, 51.276645002115984 ], [ 6.764349559682723, 51.277005393531297 ], [ 6.764068975076, 51.277443937407917 ], [ 6.764097292653916, 51.277530653309348 ], [ 6.764139738349249, 51.277660634186603 ], [ 6.76414192881806, 51.277667229928191 ], [ 6.764249997402918, 51.277992626080938 ], [ 6.764245060430366, 51.278162996183632 ], [ 6.764274682265679, 51.278461528374628 ], [ 6.764333925936308, 51.278727117451758 ], [ 6.764456527421356, 51.278974175679799 ], [ 6.76489180383472, 51.279540860471229 ], [ 6.765100802339434, 51.279713283611912 ], [ 6.765369867343537, 51.279892911807771 ], [ 6.765689947730679, 51.280069451154795 ], [ 6.765986166083819, 51.280201211858099 ], [ 6.766000281608751, 51.280291883268781 ], [ 6.766006727290547, 51.280333287199845 ], [ 6.766007559631546, 51.280338633751676 ], [ 6.766565437529958, 51.280306208397988 ], [ 6.766804880698746, 51.280168271717692 ], [ 6.766843553650405, 51.280162095438762 ], [ 6.766884695088343, 51.280217681919446 ], [ 6.768237425567681, 51.279830633916625 ] ] ] } },
{ "type": "Feature", "properties": { "id": 4, "level": 5 }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.761884364721595, 51.276909654522647 ], [ 6.764069797904758, 51.277442907967149 ], [ 6.764349559682723, 51.277006422981941 ], [ 6.76215096123942, 51.276477282320933 ], [ 6.761884364721595, 51.276909654522647 ] ] ] } },
{ "type": "Feature", "properties": { "id": 5, "level": 5 }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.766238869539168, 51.28028888725941 ], [ 6.766328122379146, 51.280282520834824 ], [ 6.766330868795506, 51.280297583476276 ], [ 6.766453770235952, 51.280288815644461 ], [ 6.76657095061673, 51.280280457314561 ], [ 6.766588932147379, 51.280292673807878 ], [ 6.766787835666206, 51.280178090859309 ], [ 6.766844002576806, 51.280162023946922 ], [ 6.766884693188022, 51.280217679431296 ], [ 6.766934717206989, 51.280203369476581 ], [ 6.766883585411751, 51.280133439239755 ], [ 6.767188609020219, 51.280046164936728 ], [ 6.767208200772963, 51.279995358935537 ], [ 6.767116893457545, 51.279870497802776 ], [ 6.767051280419469, 51.279857267469609 ], [ 6.766719143278006, 51.279952299963753 ], [ 6.766634470701907, 51.280003002151695 ], [ 6.766574506849081, 51.280003944571014 ], [ 6.766411582076843, 51.280095591902388 ], [ 6.766375880845124, 51.280098138489521 ], [ 6.766379952038213, 51.280120470093763 ], [ 6.766232684457368, 51.280130974759103 ], [ 6.766227595466006, 51.280103060258497 ], [ 6.766102641154986, 51.280111973311406 ], [ 6.76612096152389, 51.280212465414749 ], [ 6.766107573561993, 51.280213420382509 ], [ 6.766113680351628, 51.28024691770073 ], [ 6.766131530967488, 51.280245644411302 ], [ 6.76613661995885, 51.280273558825272 ], [ 6.76619017180643, 51.280269738959099 ], [ 6.766192207402975, 51.280280904720868 ], [ 6.766236833942625, 51.280277721499587 ], [ 6.766238869539168, 51.28028888725941 ] ] ] } },
{ "type": "Feature", "properties": { "id": 6, "level": 5 }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.766006727290547, 51.280333287199845 ], [ 6.766000281608751, 51.280291883268781 ], [ 6.765741642079222, 51.280308062275864 ], [ 6.764891736066264, 51.279764532232235 ], [ 6.764697916676743, 51.279600655632748 ], [ 6.76464127243579, 51.279618426147856 ], [ 6.764837664398449, 51.279784831558672 ], [ 6.765720619710684, 51.28035071433392 ], [ 6.766006727290547, 51.280333287199845 ] ] ] } },
{ "type": "Feature", "properties": { "id": 7, "level": 5 }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.764271790978459, 51.279032396644666 ], [ 6.7643393089199, 51.279011022696587 ], [ 6.764324009224925, 51.278965955772257 ], [ 6.764395221198831, 51.278956498046156 ], [ 6.764376488930233, 51.278901309096661 ], [ 6.764309138781093, 51.278910253941156 ], [ 6.764151244012851, 51.27844506233847 ], [ 6.764122316727066, 51.278105778620187 ], [ 6.764174144780765, 51.27790296115635 ], [ 6.764221337169676, 51.277906329907282 ], [ 6.76414192881806, 51.277667229928191 ], [ 6.764097292653916, 51.277530653309348 ], [ 6.76405723033405, 51.277535776332321 ], [ 6.764126877335142, 51.277759930799938 ], [ 6.764090881106815, 51.277895034282608 ], [ 6.764109058387748, 51.277896929396498 ], [ 6.764080684020575, 51.278003425118285 ], [ 6.764076254585064, 51.278020050499705 ], [ 6.764056025030476, 51.278095977053304 ], [ 6.764082383514376, 51.278354292882305 ], [ 6.764084099691692, 51.278371111890721 ], [ 6.764092184137707, 51.278450340065412 ], [ 6.764271790978459, 51.279032396644666 ] ] ] } },
{ "type": "Feature", "properties": { "id": 8, "level": 5 }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.764084099691692, 51.278371111890721 ], [ 6.764082383514376, 51.278354292882305 ], [ 6.764019628645422, 51.278356793886445 ], [ 6.764015623047859, 51.278317538668489 ], [ 6.763979763412651, 51.278318970470345 ], [ 6.763985485694867, 51.278375049341122 ], [ 6.764084099691692, 51.278371111890721 ] ] ] } },
{ "type": "Feature", "properties": { "id": 9, "level": 5 }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.764076254585064, 51.278020050499705 ], [ 6.764080684020575, 51.278003425118285 ], [ 6.763938910210688, 51.277988640822926 ], [ 6.763924141998381, 51.278044069649823 ], [ 6.763986168490036, 51.278050536341929 ], [ 6.76399650623865, 51.278011736175593 ], [ 6.764076254585064, 51.278020050499705 ] ] ] } }
]
}
      });

      // Add layer to map and link source to this layer + styling of the layer
      map.addLayer({
        "id": "route",
        "type": "fill",
        "source": "route",
        "layout": {
          "line-join": "round",
          "line-cap": "round"
        },
        "paint": {
          "line-color": "#888",
          "line-width": 8
        }
      });
    }
  },

  removeMarker: function(id) {
    // Remove source from all maps
    for(var map in this.get('maps')) {
      map = this.get('maps.'+map);

      map.removeSource(id);
      map.update();
    }
  },

  getMarker: function(map, e) {

  }
});
